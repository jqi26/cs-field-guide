apiVersion: apps/v1
kind: Deployment
metadata:
  name: django-deployment
  labels:
    app: django
spec:
  replicas: 1
  selector:
    matchLabels:
      app: django
  template:
    metadata:
      labels:
        app: django
    spec:
      containers:
      - name: django
        image: danalambert/cs-field-guide_django
        ports:
        - containerPort: 81
        command: ["/cs-field-guide/csfieldguide/docker-development-entrypoint.sh"]
        env:
          - name: POSTGRES_USER
            valueFrom:
              secretKeyRef:
                name: postgres-credentials
                key: user
          - name: POSTGRES_PASSWORD
            valueFrom:
              secretKeyRef:
                name: postgres-credentials
                key: password
          - name: POSTGRES_HOST
            value: postgres-service
          - name: DJANGO_SETTINGS_MODULE
            value: config.settings.local
          - name: INCLUDE_INCONTEXT_L10N
            value: "False"
          - name: PORT
            value: "8080"
        volumeMounts:
        - mountPath: /cs-field-guide
          name: fieldguide-project
      volumes:
      - name: fieldguide-project
        hostPath:
          path: /home/docker/cs-field-guide
      - name: project-files
        hostPath:
          path: /home/docker/cs-field-guide/csfieldguide
---
apiVersion: v1
kind: Service
metadata:
  name: django-service
spec:
  selector:
    app: django
  ports:
    - protocol: TCP
      port: 81
      targetPort: 8080
